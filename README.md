# eora-retail-helper-widget

RAG-сервис для ответов на вопросы потенциальных клиентов EORA на основе материалов сайта и документов компании.

## Особенности

- **Три уровня сложности**: Простые ответы, со списком источников, с inline ссылками
- **Автоматический парсинг**: 35+ кейсов с сайта eora.ru загружаются автоматически
- **Векторный поиск**: FAISS для быстрого семантического поиска по документам
- **Интерактивный чат**: Streamlit интерфейс с историей сообщений и примерами
- **Кэширование**: Оптимизированная производительность с Streamlit cache
- **Валидация**: Защита от XSS и некорректного пользовательского ввода
- **Мониторинг**: Отслеживание производительности и использования памяти
- **Docker**: Готовая контейнеризация для простого развертывания

## Быстрый старт

### Требования

- Python 3.8+
- OpenAI API ключ
- Docker (опционально)

### Установка

1. Установите [uv](https://github.com/astral-sh/uv):
```bash
# На Linux/macOS через curl
curl -LsSf https://astral.sh/uv/install.sh | sh
# или через pip
pip install uv
```

2. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd eora-rag-service
```

3. Установите зависимости:
```bash
uv sync
```

4. Настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env файл, добавив ваш OPENAI_API_KEY
```

5. Запустите приложение:
```bash
streamlit run app.py
```
## Docker запуск

### Быстрый старт с Docker

```bash
# Запуск только с локальными файлами (рекомендуется)
OPENAI_API_KEY=your_key_here ENABLE_WEB_CRAWLING=false docker-compose up --build

# Или с веб-краулингом (может быть медленно)
OPENAI_API_KEY=your_key_here ENABLE_WEB_CRAWLING=true docker-compose up --build
```

### Полная настройка с Docker

```bash
# Клонирование и настройка
git clone <repository-url>
cd eora-rag-service
cp .env.example .env
# Отредактируйте .env файл

# Запуск
docker-compose up --build
```

Приложение будет доступно по адресу: `http://localhost:8501`

## Структура проекта

```
eora-rag-service/
├── app.py                      # Streamlit приложение
├── core/                       # Основные компоненты
│   ├── rag_chain.py           # RAG pipeline
│   ├── config.py              # Конфигурация
│   ├── exceptions.py          # Кастомные исключения
│   └── llm_providers.py       # Провайдеры LLM
├── utils/                      # Утилиты
│   ├── file_loader.py         # Загрузчик файлов
│   ├── web_crawler.py         # Веб-краулер
│   ├── error_handler.py       # Обработка ошибок
│   ├── performance.py         # Мониторинг производительности
│   └── validation.py          # Валидация данных
├── tests/                      # Тесты
│   ├── test_rag_chain.py      # Тесты RAG pipeline
│   ├── test_integration.py    # Интеграционные тесты
│   └── ...
├── data/                       # Документы для индексации
├── pyproject.toml             # Зависимости проекта
├── .env.example               # Пример конфигурации
└── README.md
```

## Интерфейс приложения

### Основные функции

- **Чат-интерфейс**: Интерактивное общение с AI ассистентом
- **Примеры вопросов**: Готовые кнопки с типичными вопросами клиентов
- **Уровни сложности**: Переключение между easy/medium/hard режимами
- **История сообщений**: Сохранение диалога в рамках сессии
- **Отображение источников**: Показ использованных документов и ссылок
- **Статистика**: Мониторинг количества сообщений и использования памяти

### Примеры вопросов

- "Что вы можете сделать для ритейлеров?"
- "Расскажите про HR-бота для Магнита"
- "Какие проекты вы делали для KazanExpress?"
- "Что такое поиск по картинкам для одежды?"
- "Какие чат-боты вы разрабатывали?"

## Архитектура

### Компоненты системы

1. **RAG Pipeline** (`core/rag_chain.py`)
   - Загрузка и индексация документов
   - Векторный поиск с FAISS
   - Генерация ответов через LLM

2. **Загрузчики данных** (`utils/`)
   - `file_loader.py`: PDF, DOCX, HTML, TXT файлы
   - `web_crawler.py`: Парсинг сайта eora.ru

3. **Обработка ошибок** (`utils/error_handler.py`)
   - Централизованная система исключений
   - Логирование и мониторинг

4. **Валидация** (`utils/validation.py`)
   - Проверка пользовательского ввода
   - Защита от XSS атак

### Принципы архитектуры

1. **Модульность**: Четкое разделение ответственности
2. **Расширяемость**: Легкое добавление новых провайдеров LLM
3. **Тестируемость**: Высокое покрытие unit и интеграционными тестами
4. **Производительность**: Кэширование на всех уровнях
5. **Безопасность**: Валидация входных данных и обработка ошибок

## Тестирование

### Запуск тестов

```bash
# Все тесты
pytest

# С покрытием кода
pytest --cov=core --cov=utils

# Конкретные модули
pytest tests/test_rag_chain.py
pytest tests/test_integration.py
pytest tests/test_validation.py
```
